<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PavamanDroneConfigurator.UI.ViewModels"
             xmlns:models="using:PavamanDroneConfigurator.Core.Models"
             x:Class="PavamanDroneConfigurator.UI.Views.ParametersPage"
             x:DataType="vm:ParametersPageViewModel">

    <UserControl.Styles>
        <!-- Header Row Style -->
        <Style Selector="TextBlock.header">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#9CA3AF"/>
            <Setter Property="Padding" Value="8,12"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Cell Style -->
        <Style Selector="TextBlock.cell">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="Padding" Value="8,8"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Parameter Name Cell -->
        <Style Selector="TextBlock.param-name">
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#1F2937"/>
            <Setter Property="Padding" Value="8,8"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Row Border -->
        <Style Selector="Border.row">
            <Setter Property="BorderBrush" Value="#E5E7EB"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <Style Selector="Border.row:pointerover">
            <Setter Property="Background" Value="#F3F4F6"/>
        </Style>

        <!-- Button Styles -->
        <Style Selector="Button.action-btn">
            <Setter Property="Background" Value="#3B82F6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <Style Selector="Button.action-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#2563EB"/>
        </Style>

        <Style Selector="Button.outline-btn">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#3B82F6"/>
            <Setter Property="BorderBrush" Value="#3B82F6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="16,8"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
        
        <Style Selector="Button.outline-btn:pointerover /template/ ContentPresenter">
            <Setter Property="Background" Value="#EFF6FF"/>
        </Style>

        <!-- Value TextBox Style -->
        <Style Selector="TextBox.value-input">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Foreground" Value="#374151"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="TextAlignment" Value="Right"/>
            <Setter Property="MinWidth" Value="70"/>
        </Style>

        <Style Selector="TextBox.value-input:focus">
            <Setter Property="Background" Value="#FEF3C7"/>
            <Setter Property="BorderBrush" Value="#F59E0B"/>
        </Style>

        <!-- Options ComboBox Style -->
        <Style Selector="ComboBox.options-combo">
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#D1D5DB"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="MinWidth" Value="120"/>
            <Setter Property="MaxWidth" Value="160"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <!-- Loading Spinner -->
        <Style Selector="ProgressBar.spinner">
            <Setter Property="IsIndeterminate" Value="True"/>
            <Setter Property="Height" Value="3"/>
            <Setter Property="Foreground" Value="#3B82F6"/>
        </Style>

        <!-- Description text style -->
        <Style Selector="TextBlock.desc-text">
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Foreground" Value="#6B7280"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Padding" Value="8,8"/>
        </Style>
    </UserControl.Styles>

    <Grid RowDefinitions="Auto,Auto,*" Background="#FFFFFF">
        
        <!-- Header Section -->
        <StackPanel Grid.Row="0" Margin="20,16,20,0" Spacing="12">
            <!-- Title and Search Row -->
            <Grid ColumnDefinitions="Auto,*,Auto">
                <!-- Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="??" FontSize="20" VerticalAlignment="Center"/>
                    <TextBlock Text="FULL PARAMETER LIST" 
                               FontSize="18" 
                               FontWeight="Bold" 
                               Foreground="#3B82F6"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Search Box -->
                <Border Grid.Column="2" 
                        Background="White" 
                        BorderBrush="#D1D5DB" 
                        BorderThickness="1" 
                        CornerRadius="6"
                        Padding="8,0"
                        MinWidth="260">
                    <Grid ColumnDefinitions="Auto,*">
                        <TextBlock Grid.Column="0" Text="??" FontSize="14" Margin="4,0,8,0" VerticalAlignment="Center"/>
                        <TextBox Grid.Column="1"
                                 Text="{Binding SearchText, Mode=TwoWay}"
                                 Watermark="Search parameters..."
                                 BorderThickness="0"
                                 Background="Transparent"
                                 Padding="4,6"
                                 FontSize="12"/>
                    </Grid>
                </Border>
            </Grid>

            <!-- Import/Export Row -->
            <StackPanel Orientation="Horizontal" Spacing="10">
                <Button Content="?? Import" 
                        Classes="action-btn"
                        Command="{Binding ImportParametersCommand}"
                        ToolTip.Tip="Import parameters from a file"/>
                <Button Content="?? Export" 
                        Classes="outline-btn"
                        Command="{Binding ExportParametersCommand}"
                        ToolTip.Tip="Export current parameters to a file"/>
                <Button Content="?? Refresh" 
                        Classes="outline-btn"
                        Command="{Binding RefreshParametersCommand}"
                        ToolTip.Tip="Reload parameters from drone"/>

                <!-- Modified count indicator -->
                <Border Background="#FEF3C7" 
                        CornerRadius="6" 
                        Padding="10,4"
                        Margin="8,0,0,0"
                        IsVisible="{Binding HasUnsavedChanges}">
                    <TextBlock FontSize="11" Foreground="#92400E">
                        <Run Text="{Binding ModifiedParameterCount}"/>
                        <Run Text=" modified"/>
                    </TextBlock>
                </Border>

                <!-- Parameter count -->
                <Border Background="#EFF6FF" 
                        CornerRadius="6" 
                        Padding="10,4"
                        Margin="8,0,0,0">
                    <TextBlock FontSize="11" Foreground="#1E40AF">
                        <Run Text="{Binding LoadedParameterCount}"/>
                        <Run Text=" / "/>
                        <Run Text="{Binding TotalParameterCount}"/>
                        <Run Text=" params"/>
                    </TextBlock>
                </Border>
            </StackPanel>

            <!-- Loading Indicator -->
            <ProgressBar Classes="spinner" IsVisible="{Binding IsRefreshing}" />

            <!-- Status Message -->
            <TextBlock Text="{Binding StatusMessage}" 
                       FontSize="11" 
                       Foreground="#6B7280"
                       IsVisible="{Binding HasStatusMessage}"/>
        </StackPanel>

        <!-- Table Header (like Mission Planner) -->
        <Border Grid.Row="1" 
                BorderBrush="#E5E7EB" 
                BorderThickness="0,0,0,2"
                Background="#F9FAFB"
                Margin="20,12,20,0">
            <Grid ColumnDefinitions="180,80,70,70,140,*">
                <TextBlock Grid.Column="0" Text="Name" Classes="header"/>
                <TextBlock Grid.Column="1" Text="Value" Classes="header"/>
                <TextBlock Grid.Column="2" Text="Default" Classes="header"/>
                <TextBlock Grid.Column="3" Text="Units" Classes="header"/>
                <TextBlock Grid.Column="4" Text="Options" Classes="header"/>
                <TextBlock Grid.Column="5" Text="Desc" Classes="header"/>
            </Grid>
        </Border>

        <!-- Parameters List (like Mission Planner table) -->
        <ScrollViewer Grid.Row="2" 
                      Margin="20,0,20,16"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding FilteredParameters}" IsEnabled="{Binding CanEditParameters}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="models:DroneParameter">
                        <Border Classes="row" 
                                PointerPressed="OnParameterRowPressed"
                                Tag="{Binding}">
                            <Grid ColumnDefinitions="180,80,70,70,140,*" MinHeight="36">
                                
                                <!-- Name -->
                                <TextBlock Grid.Column="0" 
                                           Text="{Binding Name}" 
                                           Classes="param-name"
                                           TextTrimming="CharacterEllipsis"
                                           ToolTip.Tip="{Binding Name}"/>

                                <!-- Value (Editable) -->
                                <TextBox Grid.Column="1"
                                         Text="{Binding Value, Mode=TwoWay}"
                                         Classes="value-input"
                                         Margin="4,4"
                                         ToolTip.Tip="Edit value and press Enter to save"/>

                                <!-- Default -->
                                <TextBlock Grid.Column="2" 
                                           Text="{Binding DefaultDisplay}"
                                           Classes="cell"
                                           Foreground="#9CA3AF"/>

                                <!-- Units -->
                                <TextBlock Grid.Column="3" 
                                           Text="{Binding Units, TargetNullValue=''}"
                                           Classes="cell"
                                           Foreground="#6B7280"/>

                                <!-- Options (ComboBox for enum params, Range text for others) -->
                                <Panel Grid.Column="4" Margin="4,4">
                                    <!-- ComboBox for parameters with options -->
                                    <ComboBox Classes="options-combo"
                                              ItemsSource="{Binding Options}"
                                              SelectedItem="{Binding SelectedOption, Mode=TwoWay}"
                                              IsVisible="{Binding HasOptions}"
                                              DisplayMemberBinding="{Binding Display}">
                                    </ComboBox>
                                    
                                    <!-- Range display for parameters without options -->
                                    <TextBlock Text="{Binding RangeDisplay}"
                                               IsVisible="{Binding !HasOptions}"
                                               FontSize="11"
                                               Foreground="#3B82F6"
                                               VerticalAlignment="Center"
                                               Padding="4,0"/>
                                </Panel>

                                <!-- Description -->
                                <TextBlock Grid.Column="5" 
                                           Text="{Binding Description, TargetNullValue='No description'}" 
                                           Classes="desc-text"
                                           MaxLines="2"
                                           TextTrimming="CharacterEllipsis"
                                           ToolTip.Tip="{Binding Description}"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
