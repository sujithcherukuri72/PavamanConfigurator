<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:PavamanDroneConfigurator.UI.ViewModels"
             xmlns:conv="using:PavamanDroneConfigurator.UI.Converters"
             x:Class="PavamanDroneConfigurator.UI.Views.RcCalibrationPage"
             x:DataType="vm:RcCalibrationPageViewModel">

    <UserControl.Resources>
        <conv:BoolToStringConverter x:Key="CalibrationButtonTextConverter"/>
    </UserControl.Resources>

    <UserControl.Styles>
        <!-- Aviation-Grade Color System -->
        <Style Selector="TextBlock.PageTitle">
            <Setter Property="FontSize" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#0B5ED7"/>
        </Style>
        
        <Style Selector="TextBlock.SectionTitle">
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#0B5ED7"/>
            <Setter Property="Margin" Value="0,0,0,4"/>
        </Style>
        
        <Style Selector="TextBlock.SectionSubtitle">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="Margin" Value="0,0,0,16"/>
        </Style>
        
        <Style Selector="TextBlock.FieldLabel">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="Margin" Value="0,0,0,6"/>
        </Style>
        
        <Style Selector="TextBlock.ChannelLabel">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#1E293B"/>
            <Setter Property="Width" Value="80"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style Selector="TextBlock.ChannelValue">
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="Width" Value="40"/>
            <Setter Property="TextAlignment" Value="Right"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        
        <Style Selector="TextBlock.WarningText">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="Foreground" Value="#DC2626"/>
            <Setter Property="Margin" Value="0,8,0,16"/>
        </Style>
        
        <Style Selector="Border.SectionCard">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E2E8F0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
        </Style>
        
        <Style Selector="Button.Primary">
            <Setter Property="Background" Value="#22D3EE"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Padding" Value="24,12"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="Button.Primary:pointerover">
            <Setter Property="Background" Value="#06B6D4"/>
        </Style>
        
        <Style Selector="Button.Secondary">
            <Setter Property="Background" Value="#6C757D"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="16,10"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style Selector="ProgressBar.ChannelBar">
            <Setter Property="Height" Value="8"/>
            <Setter Property="Minimum" Value="800"/>
            <Setter Property="Maximum" Value="2200"/>
            <Setter Property="Background" Value="#1E293B"/>
            <Setter Property="Foreground" Value="#64748B"/>
            <Setter Property="CornerRadius" Value="4"/>
        </Style>
        
        <Style Selector="ComboBox">
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="MinWidth" Value="140"/>
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
        </Style>
        
        <Style Selector="Border.Separator">
            <Setter Property="Height" Value="1"/>
            <Setter Property="Background" Value="#E2E8F0"/>
            <Setter Property="Margin" Value="0,24,0,24"/>
        </Style>
    </UserControl.Styles>

    <ScrollViewer HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24" MaxWidth="1200">
            
            <!-- HEADER SECTION -->
            <Grid ColumnDefinitions="*,Auto,Auto" Margin="0,0,0,16">
                <StackPanel Grid.Column="0">
                    <TextBlock Classes="PageTitle" Text="RC Calibration"/>
                </StackPanel>
                
                <Button Grid.Column="1" Classes="Secondary" Command="{Binding RefreshCommand}" Margin="0,0,8,0">
                    <StackPanel Orientation="Horizontal" Spacing="6">
                        <TextBlock Text="?" FontSize="16"/>
                        <TextBlock Text="Refresh"/>
                    </StackPanel>
                </Button>
            </Grid>

            <!-- RC CALIBRATION SECTION -->
            <Border Classes="SectionCard">
                <StackPanel>
                    <TextBlock Classes="SectionTitle" Text="RC CALIBRATION"/>
                    
                    <!-- Warning/Status Text -->
                    <TextBlock Classes="WarningText" 
                               Text="{Binding CalibrationStatusText}"
                               IsVisible="{Binding CalibrationRequired}"/>
                    <TextBlock Classes="SectionSubtitle" 
                               Text="{Binding CalibrationStatusText}"
                               IsVisible="{Binding !CalibrationRequired}"/>
                    
                    <!-- Main Attitude Channels -->
                    <StackPanel Spacing="16" Margin="0,8,0,24">
                        
                        <!-- Roll -->
                        <Grid ColumnDefinitions="80,*,50">
                            <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Roll"/>
                            <ProgressBar Grid.Column="1" Classes="ChannelBar" 
                                         Value="{Binding RollValue}"/>
                            <TextBlock Grid.Column="2" Classes="ChannelValue" 
                                       Text="{Binding RollValue}"/>
                        </Grid>
                        
                        <!-- Pitch -->
                        <Grid ColumnDefinitions="80,*,50">
                            <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Pitch"/>
                            <ProgressBar Grid.Column="1" Classes="ChannelBar" 
                                         Value="{Binding PitchValue}"/>
                            <TextBlock Grid.Column="2" Classes="ChannelValue" 
                                       Text="{Binding PitchValue}"/>
                        </Grid>
                        
                        <!-- Yaw -->
                        <Grid ColumnDefinitions="80,*,50">
                            <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Yaw"/>
                            <ProgressBar Grid.Column="1" Classes="ChannelBar" 
                                         Value="{Binding YawValue}"/>
                            <TextBlock Grid.Column="2" Classes="ChannelValue" 
                                       Text="{Binding YawValue}"/>
                        </Grid>
                        
                        <!-- Throttle -->
                        <Grid ColumnDefinitions="80,*,50">
                            <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Throttle"/>
                            <ProgressBar Grid.Column="1" Classes="ChannelBar" 
                                         Value="{Binding ThrottleValue}"/>
                            <TextBlock Grid.Column="2" Classes="ChannelValue" 
                                       Text="{Binding ThrottleValue}"/>
                        </Grid>
                    </StackPanel>
                    
                    <!-- Calibrate Button -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                        <Button Classes="Primary" Command="{Binding CalibrateCommand}">
                            <TextBlock Text="{Binding IsCalibrating, Converter={StaticResource CalibrationButtonTextConverter}, ConverterParameter='Complete|Calibrate'}"/>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- SEPARATOR -->
            <Border Classes="Separator"/>

            <!-- ATTITUDE CHANNEL SETTING SECTION -->
            <Border Classes="SectionCard">
                <StackPanel>
                    <TextBlock Classes="SectionTitle" Text="Attitude Channel Setting"/>
                    <TextBlock Classes="SectionSubtitle" Text="Map control functions to RC channels"/>
                    
                    <Grid ColumnDefinitions="*,24,*" RowDefinitions="Auto,24,Auto" Margin="0,8,0,0">
                        
                        <!-- Throttle -->
                        <StackPanel Grid.Column="0" Grid.Row="0">
                            <TextBlock Classes="FieldLabel" Text="Throttle"/>
                            <ComboBox ItemsSource="{Binding ChannelOptions}"
                                      SelectedItem="{Binding SelectedThrottleChannel}"
                                      DisplayMemberBinding="{Binding Label}"/>
                        </StackPanel>
                        
                        <!-- Roll -->
                        <StackPanel Grid.Column="2" Grid.Row="0">
                            <TextBlock Classes="FieldLabel" Text="Roll"/>
                            <ComboBox ItemsSource="{Binding ChannelOptions}"
                                      SelectedItem="{Binding SelectedRollChannel}"
                                      DisplayMemberBinding="{Binding Label}"/>
                        </StackPanel>
                        
                        <!-- Pitch -->
                        <StackPanel Grid.Column="0" Grid.Row="2">
                            <TextBlock Classes="FieldLabel" Text="Pitch"/>
                            <ComboBox ItemsSource="{Binding ChannelOptions}"
                                      SelectedItem="{Binding SelectedPitchChannel}"
                                      DisplayMemberBinding="{Binding Label}"/>
                        </StackPanel>
                        
                        <!-- Yaw -->
                        <StackPanel Grid.Column="2" Grid.Row="2">
                            <TextBlock Classes="FieldLabel" Text="Yaw"/>
                            <ComboBox ItemsSource="{Binding ChannelOptions}"
                                      SelectedItem="{Binding SelectedYawChannel}"
                                      DisplayMemberBinding="{Binding Label}"/>
                        </StackPanel>
                    </Grid>
                    
                    <!-- Update Button -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,24,0,0">
                        <Button Classes="Primary" Command="{Binding UpdateMappingCommand}">
                            <TextBlock Text="Update Mapping"/>
                        </Button>
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- SEPARATOR -->
            <Border Classes="Separator"/>

            <!-- CHANNEL MONITOR SECTION -->
            <Border Classes="SectionCard">
                <StackPanel>
                    <TextBlock Classes="SectionTitle" Text="CHANNEL MONITOR"/>
                    <TextBlock Classes="SectionSubtitle" Text="Live RC input values for all 16 channels"/>
                    
                    <Grid ColumnDefinitions="*,48,*" Margin="0,8,0,0">
                        
                        <!-- Left Column: Channels 1-8 -->
                        <StackPanel Grid.Column="0" Spacing="12">
                            
                            <!-- Channel 1 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 1"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel1Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel1Value}"/>
                            </Grid>
                            
                            <!-- Channel 2 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 2"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel2Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel2Value}"/>
                            </Grid>
                            
                            <!-- Channel 3 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 3"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel3Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel3Value}"/>
                            </Grid>
                            
                            <!-- Channel 4 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 4"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel4Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel4Value}"/>
                            </Grid>
                            
                            <!-- Channel 5 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 5"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel5Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel5Value}"/>
                            </Grid>
                            
                            <!-- Channel 6 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 6"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel6Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel6Value}"/>
                            </Grid>
                            
                            <!-- Channel 7 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 7"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel7Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel7Value}"/>
                            </Grid>
                            
                            <!-- Channel 8 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 8"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel8Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel8Value}"/>
                            </Grid>
                        </StackPanel>
                        
                        <!-- Right Column: Channels 9-16 -->
                        <StackPanel Grid.Column="2" Spacing="12">
                            
                            <!-- Channel 9 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 9"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel9Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel9Value}"/>
                            </Grid>
                            
                            <!-- Channel 10 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 10"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel10Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel10Value}"/>
                            </Grid>
                            
                            <!-- Channel 11 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 11"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel11Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel11Value}"/>
                            </Grid>
                            
                            <!-- Channel 12 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 12"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel12Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel12Value}"/>
                            </Grid>
                            
                            <!-- Channel 13 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 13"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel13Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel13Value}"/>
                            </Grid>
                            
                            <!-- Channel 14 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 14"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel14Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel14Value}"/>
                            </Grid>
                            
                            <!-- Channel 15 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 15"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel15Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel15Value}"/>
                            </Grid>
                            
                            <!-- Channel 16 -->
                            <Grid ColumnDefinitions="80,*,40">
                                <TextBlock Grid.Column="0" Classes="ChannelLabel" Text="Channel 16"/>
                                <ProgressBar Grid.Column="1" Classes="ChannelBar" Value="{Binding Channel16Value}"/>
                                <TextBlock Grid.Column="2" Classes="ChannelValue" Text="{Binding Channel16Value}"/>
                            </Grid>
                        </StackPanel>
                    </Grid>
                </StackPanel>
            </Border>

            <!-- STATUS BAR -->
            <Border Background="#F5F5F5" CornerRadius="6" Padding="12" Margin="0,8,0,0" IsVisible="{Binding IsBusy}">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <ProgressBar Width="20" Height="20" IsIndeterminate="True"/>
                    <TextBlock Text="{Binding StatusMessage}" VerticalAlignment="Center" Foreground="#1E293B"/>
                </StackPanel>
            </Border>

            <!-- INFO FOOTER -->
            <Border Background="#E7F3FF" CornerRadius="8" Padding="16" Margin="0,16,0,0">
                <StackPanel Orientation="Horizontal" Spacing="8">
                    <TextBlock Text="?" FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock TextWrapping="Wrap" FontSize="12" Foreground="#0B5ED7">
                        <Run Text="PDRL Compliance:"/>
                        <Run Text="All main control channels (Roll, Pitch, Yaw, Throttle) must be properly calibrated before flight. Move sticks to all extremes during calibration."/>
                    </TextBlock>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
